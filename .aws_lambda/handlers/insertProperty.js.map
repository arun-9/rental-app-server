{
  "version": 3,
  "sources": ["../../src/handlers/insertProperty.ts", "../../src/db/connection.ts", "../../src/db/models/managers.ts", "../../src/db/models/properties.ts"],
  "sourcesContent": ["import { connectToDb } from \"../db/connection\";\r\nimport { getManagerModel } from \"../db/models/managers\";\r\nimport { getPropertyModel } from \"../db/models/properties\";\r\nimport type { IProperties } from \"../db/models/properties\";\r\nimport type { Sequelize } from \"sequelize\";\r\nimport type { APIGatewayProxyEvent, APIGatewayProxyResult } from \"aws-lambda\";\r\n\r\nlet sequelize: Sequelize | null = null;\r\nlet Properties: IProperties | null = null;\r\n\r\nexport default async (event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> => {\r\n  if (!sequelize) {\r\n    sequelize = await connectToDb();\r\n    await getManagerModel(sequelize); // Ensure managers table is synced\r\n    Properties = await getPropertyModel(sequelize);\r\n  }\r\n\r\n  const body = JSON.parse(event.body ?? \"{}\");\r\n\r\n  // Optional: basic validation\r\n  if (!body.managerId || !body.name || !body.address || !body.imgUrl) {\r\n    return {\r\n      statusCode: 400,\r\n      body: JSON.stringify({ message: \"Missing required fields.\" }),\r\n    };\r\n  }\r\n\r\n  try {\r\n    const createdProperty = await Properties.create(body, { returning: true });\r\n\r\n    return {\r\n      statusCode: 201,\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify(createdProperty.toJSON()),\r\n    };\r\n  } catch (err: any) {\r\n    return {\r\n      statusCode: 500,\r\n      body: JSON.stringify({ error: \"Failed to insert property\", details: err.message }),\r\n    };\r\n  }\r\n};\r\n", "import { Sequelize } from \"sequelize\";\r\n\r\nconst { TIMEOUT, DB_HOST, DB_NAME, DB_USER, DB_PASSWORD } = process.env;\r\nconst timeout = Number(TIMEOUT) * 1000;\r\nconst URI = `postgres://${DB_USER}:${DB_PASSWORD}@${DB_HOST}/${DB_NAME}`;\r\n\r\nlet sequelize: Sequelize | null = null;\r\n\r\n// https://sequelize.org/docs/v6/other-topics/aws-lambda/#tldr\r\nexport const connectToDb = async (): Promise<Sequelize> => {\r\n  if (sequelize) {\r\n    sequelize.connectionManager.initPools();\r\n\r\n    if (sequelize.connectionManager.hasOwnProperty(\"getConnection\")) {\r\n      delete sequelize.connectionManager.getConnection;\r\n    }\r\n    return sequelize;\r\n  }\r\n\r\n  sequelize = new Sequelize(URI, {\r\n    logging: false,\r\n    pool: {\r\n      min: 0,\r\n      max: 2,\r\n      idle: 0,\r\n      acquire: 3000,\r\n      evict: timeout,\r\n    },\r\n  });\r\n  await sequelize.authenticate();\r\n\r\n  return sequelize;\r\n};\r\n", "import { Sequelize, Model, DataTypes } from \"sequelize\";\r\nimport type { ModelAttributes } from \"sequelize\";\r\n\r\nclass Managers extends Model {}\r\n\r\nconst schema: ModelAttributes = {\r\n  id: {\r\n    type: DataTypes.INTEGER,\r\n    autoIncrement: true,\r\n    primaryKey: true, // \u2705 PK as per image\r\n    allowNull: false,\r\n  },\r\n  cognitoId: {\r\n    type: DataTypes.STRING,\r\n    unique: true,      // \u2705 Unique constraint\r\n    allowNull: false,\r\n  },\r\n  name: {\r\n    type: DataTypes.STRING,\r\n    allowNull: false,\r\n  },\r\n  email: {\r\n    type: DataTypes.STRING,\r\n    allowNull: false,\r\n  },\r\n  phoneNumber: {\r\n    type: DataTypes.STRING,\r\n    allowNull: false,\r\n  },\r\n};\r\n\r\ntype IManagers = typeof Managers;\r\n\r\nexport const getManagerModel = async (sequelize?: Sequelize): Promise<IManagers> => {\r\n  if (sequelize) {\r\n    Managers.init(schema, {\r\n      sequelize,\r\n      modelName: \"managers\",\r\n      tableName: \"managers\",\r\n      timestamps: false,\r\n    });\r\n    await Managers.sync();\r\n  }\r\n\r\n  return Managers;\r\n};\r\n\r\nexport type { IManagers };\r\n", "import { Sequelize, Model, DataTypes } from \"sequelize\";\r\nimport type { ModelAttributes } from \"sequelize\";\r\nclass Properties extends Model {}\r\n\r\nconst schema: ModelAttributes = {\r\n  id: {\r\n    primaryKey: true,\r\n    type: DataTypes.INTEGER,\r\n    autoIncrement: true,\r\n  },\r\n  name: {\r\n    type: DataTypes.STRING,\r\n    allowNull: false,\r\n  },\r\n  address: {\r\n    type: DataTypes.STRING,\r\n    allowNull: false,\r\n  },\r\n  imgUrl: {\r\n    type: DataTypes.STRING,\r\n    allowNull: false,\r\n  },\r\n  managerId: {\r\n    type: DataTypes.UUID,\r\n    allowNull: false,\r\n    references: {\r\n      model: \"managers\",\r\n      key: \"managerId\",\r\n    },\r\n    onUpdate: \"CASCADE\",\r\n    onDelete: \"CASCADE\",\r\n  },\r\n};\r\n\r\ntype IProperties = typeof Properties;\r\nexport const getPropertyModel = async (sequelize?: Sequelize): Promise<IProperties> => {\r\n  if (sequelize) {\r\n    Properties.init(schema, { sequelize, modelName: \"properties\", timestamps: false });\r\n    await Properties.sync();\r\n  }\r\n\r\n  return Properties;\r\n};\r\n\r\nexport type { IProperties };\r\n"],
  "mappings": "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",
  "names": ["import_sequelize", "sequelize", "import_sequelize", "schema", "sequelize", "sequelize", "Properties"]
}
