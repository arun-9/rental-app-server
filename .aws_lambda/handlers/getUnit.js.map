{
  "version": 3,
  "sources": ["../../src/handlers/getUnit.ts", "../../src/db/connection.ts", "../../src/db/models/Unit.ts"],
  "sourcesContent": ["// src/handlers/getUnit.ts\r\nimport { connectToDb } from \"../db/connection\";\r\nimport { getUnitModel } from \"../db/models/Unit\";\r\nimport type { IUnit } from \"../db/models/Unit\";\r\nimport type { Sequelize } from \"sequelize\";\r\nimport type {\r\n  APIGatewayProxyEventV2,\r\n  APIGatewayProxyResultV2,\r\n} from \"aws-lambda\";\r\n\r\nlet sequelize: Sequelize | null = null;\r\nlet Unit: IUnit | null = null;\r\n\r\nconst corsHeaders = {\r\n  \"Content-Type\": \"application/json\",\r\n  \"Access-Control-Allow-Origin\": \"*\",\r\n};\r\n\r\nexport default async (\r\n  event: APIGatewayProxyEventV2\r\n): Promise<APIGatewayProxyResultV2> => {\r\n  try {\r\n    if (!sequelize) {\r\n      sequelize = await connectToDb();\r\n      Unit = await getUnitModel(sequelize);\r\n    }\r\n\r\n    const id = event.pathParameters?.id;\r\n    const result = id ? await Unit.findByPk(id) : await Unit.findAll();\r\n\r\n    return {\r\n      statusCode: 200,\r\n      headers: corsHeaders,\r\n      body: JSON.stringify(result),\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Failed to fetch unit(s):\", error);\r\n    return {\r\n      statusCode: 500,\r\n      headers: corsHeaders,\r\n      body: JSON.stringify({ error: \"Failed to fetch unit(s)\" }),\r\n    };\r\n  }\r\n};\r\n", "import { Sequelize } from \"sequelize\";\r\n\r\nconst { TIMEOUT, DB_HOST, DB_NAME, DB_USER, DB_PASSWORD } = process.env;\r\nconst timeout = Number(TIMEOUT) * 1000;\r\nconst URI = `postgres://${DB_USER}:${DB_PASSWORD}@${DB_HOST}/${DB_NAME}`;\r\n\r\nlet sequelize: Sequelize | null = null;\r\n\r\n// https://sequelize.org/docs/v6/other-topics/aws-lambda/#tldr\r\nexport const connectToDb = async (): Promise<Sequelize> => {\r\n  if (sequelize) {\r\n    sequelize.connectionManager.initPools();\r\n\r\n    if (sequelize.connectionManager.hasOwnProperty(\"getConnection\")) {\r\n      delete sequelize.connectionManager.getConnection;\r\n    }\r\n    return sequelize;\r\n  }\r\n\r\n  sequelize = new Sequelize(URI, {\r\n    logging: false,\r\n    pool: {\r\n      min: 0,\r\n      max: 2,\r\n      idle: 0,\r\n      acquire: 3000,\r\n      evict: timeout,\r\n    },\r\n  });\r\n  await sequelize.authenticate();\r\n\r\n  return sequelize;\r\n};\r\n", "// src/db/models/Unit.ts\r\nimport { Sequelize, Model, DataTypes } from \"sequelize\";\r\nimport type { ModelAttributes } from \"sequelize\";\r\nimport type { IProperty } from \"./Property\";\r\nimport type { ITenant } from \"./tenant\"; // import types\r\n\r\nclass Unit extends Model {}\r\n\r\nconst schema: ModelAttributes = {\r\n  id: {\r\n    type: DataTypes.INTEGER,\r\n    primaryKey: true,\r\n    autoIncrement: true,\r\n  },\r\n  unitNumber: {\r\n    type: DataTypes.STRING,\r\n    allowNull: false,\r\n  },\r\n  isVacant: {\r\n    type: DataTypes.BOOLEAN,\r\n    allowNull: false,\r\n    defaultValue: true,\r\n  },\r\n  propertyId: {\r\n    type: DataTypes.INTEGER,\r\n    allowNull: false,\r\n  },\r\n  tenantId: {\r\n    type: DataTypes.INTEGER,\r\n    allowNull: true,\r\n  },\r\n};\r\n\r\ntype IUnit = typeof Unit;\r\n\r\nexport const getUnitModel = async (\r\n  sequelize?: Sequelize,\r\n  PropertyModel?: IProperty,\r\n  TenantModel?: ITenant\r\n): Promise<IUnit> => {\r\n  if (sequelize) {\r\n    Unit.init(schema, {\r\n      sequelize,\r\n      modelName: \"unit\",\r\n      timestamps: false,\r\n    });\r\n\r\n    // Add associations\r\n    if (PropertyModel) {\r\n      Unit.belongsTo(PropertyModel, {\r\n        foreignKey: \"propertyId\",\r\n        as: \"property\",\r\n      });\r\n\r\n      PropertyModel.hasMany(Unit, {\r\n        foreignKey: \"propertyId\",\r\n        as: \"units\",\r\n      });\r\n    }\r\n\r\n    if (TenantModel) {\r\n      Unit.belongsTo(TenantModel, {\r\n        foreignKey: \"tenantId\",\r\n        as: \"tenant\",\r\n      });\r\n\r\n      TenantModel.hasOne(Unit, {\r\n        foreignKey: \"tenantId\",\r\n        as: \"unit\",\r\n      });\r\n    }\r\n\r\n    await Unit.sync();\r\n  }\r\n\r\n  return Unit;\r\n};\r\n\r\nexport type { IUnit };\r\n"],
  "mappings": "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",
  "names": ["import_sequelize", "sequelize", "sequelize", "Unit"]
}
